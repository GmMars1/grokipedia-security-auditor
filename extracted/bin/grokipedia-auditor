#!/bin/bash
# GrokiPedia Security Auditor - Main Executable
# Version: v2.3.1-solidity

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
VERSION="v2.3.1-solidity"

# Source libraries
[[ -f "${SCRIPT_DIR}/lib/core.sh" ]] && source "${SCRIPT_DIR}/lib/core.sh"
[[ -f "${SCRIPT_DIR}/lib/security.sh" ]] && source "${SCRIPT_DIR}/lib/security.sh"
[[ -f "${SCRIPT_DIR}/lib/affiliate.sh" ]] && source "${SCRIPT_DIR}/lib/affiliate.sh"

# Main function
main() {
    case "${1:-}" in
        "audit")
            shift
            run_audit "$@"
            ;;
        "affiliate")
            shift
            handle_affiliate "$@"
            ;;
        "deploy")
            shift
            deploy_site "$@"
            ;;
        "version")
            echo "GrokiPedia Security Auditor ${VERSION}"
            ;;
        "help"|"--help"|"-h"|"")
            show_help
            ;;
        *)
            echo "Unknown command: ${1:-}"
            show_help
            exit 1
            ;;
    esac
}

show_help() {
    cat << EOL
GrokiPedia Security Auditor ${VERSION}

USAGE:
    grokipedia-auditor <command> [options]

COMMANDS:
    audit <url>          Run security audit on website
    affiliate <action>   Manage affiliate operations
    deploy <domain>      Deploy to production
    version              Show version information
    help                 Show this help message

EXAMPLES:
    grokipedia-auditor audit https://example.com
    grokipedia-auditor affiliate --generate-link
    grokipedia-auditor deploy example.com

For more information, visit: https://github.com/Gmmars1/grokipedia-security-auditor
EOL
}

main "$@"
